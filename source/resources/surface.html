<!DOCTYPE html>
<html lang="en">
<head>
	<title>surface displacements</title>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
	<meta name="description" content="surface displacements by sheila packa" />
	<meta name="author" content="kathy mctavish and sheila packa">
	<!-- from ::: http://www.favicon-generator.org/ -->
	<link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
	<link rel="manifest" href="manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<!-- JSON-LD : Google -->
	<script type="application/ld+json">
		{
			"@context": "http://schema.org",
			"@type": "WebPage",
			"name": "surface displacements",
			"breadcrumb": "mctavish.studio > surface displacements",
          		"url": "http://www.mctavish.studio/surface.html",
			"description": "surface displacements ::: text by sheila packa",
			"datePublished": "Wed Nov 18 2020 12:10:53 GMT-0500 (Central Daylight Time)",
          		"image": "http://www.mctavish.io/data/mctavishIcon-01-04-01-01-01.png",
			"author": "http://mctavish.io",
			"license": "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
		}
	</script>
	<link rel="stylesheet" href="css/fieldnotes.css"/>
</head>
<body id="body" >
<div id="subtextframe" class="frame zlowest"></div>
<div id="svgframe" class="frame zlow"><svg xmlns="http://www.w3.org/2000/svg" id="svg" class="frame"></svg></div>
<div id="wordframe" class="frame z0"></div>
<!-- <div id="controlframe" class="frame zhighest"></div> -->
<div id="contentframe" class="absolute zhighest" style="opacity:0">
<nav id="controls" style="background-color:rgba(0,0,0,1.0);">
	<ul class="flex">
		<li title="hide controls" id="hidelink"><a href="#" ><svg class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 470 470" ><g><path d="M231.147,160.373l67.2,67.2l0.32-3.52c0-35.307-28.693-64-64-64L231.147,160.373z"/><path d="M234.667,117.387c58.88,0,106.667,47.787,106.667,106.667c0,13.76-2.773,26.88-7.573,38.933l62.4,62.4 c32.213-26.88,57.6-61.653,73.28-101.333c-37.013-93.653-128-160-234.773-160c-29.867,0-58.453,5.333-85.013,14.933l46.08,45.973 C207.787,120.267,220.907,117.387,234.667,117.387z"/><path d="M21.333,59.253l48.64,48.64l9.707,9.707C44.48,145.12,16.64,181.707,0,224.053c36.907,93.653,128,160,234.667,160 c33.067,0,64.64-6.4,93.547-18.027l9.067,9.067l62.187,62.293l27.2-27.093L48.533,32.053L21.333,59.253z M139.307,177.12 l32.96,32.96c-0.96,4.587-1.6,9.173-1.6,13.973c0,35.307,28.693,64,64,64c4.8,0,9.387-0.64,13.867-1.6l32.96,32.96  c-14.187,7.04-29.973,11.307-46.827,11.307C175.787,330.72,128,282.933,128,224.053C128,207.2,132.267,191.413,139.307,177.12z" /></g></svg></a></li>
		<li title="home" id="homelink"><a href="#home" ><svg class="icon" xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 510 510" ><polygon points="204,471.75 204,318.75 306,318.75 306,471.75 433.5,471.75 433.5,267.75 510,267.75 255,38.25 0,267.75 76.5,267.75 76.5,471.75"/></svg></a></li>
		<li title="sound" id="soundlink"><a href="#" ><svg class="icon" xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 459 459" ><path d="M0,153v153h102l127.5,127.5v-408L102,153H0z M344.25,229.5c0-45.9-25.5-84.15-63.75-102v204 C318.75,313.65,344.25,275.4,344.25,229.5z M280.5,5.1v53.55C354.45,81.6,408,147.899,408,229.5S354.45,377.4,280.5,400.35V453.9 C382.5,430.949,459,339.15,459,229.5C459,119.85,382.5,28.049,280.5,5.1z"/></svg></a></li>
		<li class="title" title="telegraph" id="telegraph">(sound off)</li>
		<li class="title" title="clock" id="clock">here | now</li>
	</ul>
</nav>
<nav title="menu" id="menulink" style="display:none" >
	<ul class="flex">
		<li ><a href="#" ><svg class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 459 459"><path d="M0,382.5h459v-51H0V382.5z M0,255h459v-51H0V255z M0,76.5v51h459v-51H0z"/></svg></a></li>
	</ul>
</nav>
<div id="mainflex">
<main id="main" class="compress" data-state="compressed">	
<article class="poem" >
	<header>
	<h1>1 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
On the Laurentian Divide, one river falls over stones to Hudson
Bay. Another falls south through fields to the Mississippi. The
third river goes east through the Great Lakes and St. Lawrence
Seaway. Underneath, the minerals whisper: iron, manganese,
copper, nickel, platinum, and titanium.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>2 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Handfuls of water. A body of sea smoke, of wind, a body of
motion, an ocean without salt. In the benthos, tailings from
taconite mines. In the basin, shipwrecks and broken bottles and
sunken barrels and bodies the lake has claimed.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>3 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
On a bridge made of paper, my voice turns to vapor. On a bridge
made of iron and steel, I veer between traction and black ice,
wander through beams and woven branches, follow the rain in its
tracks through roots and excavations. I cross before, almost, never,
the thunder of interior dialogues through heavy machinery.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>4 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Practicing the old art that some don’t believe, my father once
crossed the slope of land holding a slender branch, calling the
water. Divining. Now, in a dark room, his daughter holds a cello to
her breast. In the instrument is the old tree. The wood turns toward
harmonics. The bow rises, glides, floats above the bridge. Calls of
the geese overhead vibrate against the windowpane. Her fingers
tremble like strings. The water answers. A car comes down the
street. The driver, locked in a dream, rolls down the hill like a
river. Slower. Still. The branch dips and the invisible flows into the
containers. The forked branch didn&#39;t know it had lost its root. It
only had yearning.

</li>
		</ul>
	</div>
</article>


<article class="poem" >
	<header>
	<h1>5 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
I call the rivers in the forgotten language. I call the Sawtooth
Mountains, the forested slopes with snowshoe hares and deer beds
and bears&#39; dens and lynx and shore&#39;s perpetual threshold. In the
city, in a house, I call a moth caught between two panes of glass.
To catch it will damage the wings. To leave it means it will perish.
Paralyzed — I write with the trapped and desperate flight.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>6 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
No one can follow the map of the bee. Their business is in every
direction for honey, from tiger lilies into the hives to the chives to
other realms with heads of clover. Apple blossoms. In the lavender
colonnades of mint through the rooms of June into purple irises,
yellow daylilies, deep inside delicate tunnels with hardly a
foothold, hidden in clouds of pollen.

</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>7 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Along Fourth Street, a river climbs a bed of stones, amid revelers,
but alone over a steep slope with winter&#39;s melt below a bridge, a
bird on a wire, hidden by trees past a canvas tent and pillow
with nobody home. A river climbs the constellation of Orion roams
through clouds and goes on a shifting path, a sleepless river. Deep.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>8 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
A blueprint on a scroll of paper: a bridge made for floating on air,
but heavily, on pylons, in plaits of current, between curved lines,
steel cables and bows of quicksilver and mercury and yellow signs.
A map to join the separated, cast a permanent shadow on the water,
resist wind and gravity and above all, to hum.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>9 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Between the steel rails of a bridge on ramps of forward and back
— I drive through ribs of a spider&#39;s web. Through ribs of steel. A
flash. One city becomes another. Once in a dark kitchen, there was
a woman sifting flour. Once the oil of the lamp climbed a wick and
lit a small conflagration, rosy above the round oak table in a circle
of chairs. The roar of flame mingled with the chink of silver plate
and the smell of coffee. Cars surge past a blur of years suspended
into a fine dust. The bridge sways as wheels stir the filaments —
and language itself begins to lift into a place where words can&#39;t
reach.

</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>10 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
On foot. On the span, falling without falling. Say I cross the
bridge, although it is windy and missteps are fatal. Say clouds
cover the moon and I cross borders without knowing, say the wind
blows at my clothes, strips me of my protection and I lose my
footing. Say I fall through the night, break through the surface in a
cold fire. Say I vacate — abandon my saying, withdraw my breath,
take my hands from my hands, twist from my shoulders. Say I
walk or am carried to the place before birth, the place where the
sun comes as a ribbon of heat. Say I arrive in another language,
wings lifting and landing, to speak with a wild tongue.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>11 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
A river catches herself as she is falling. She is a cloud that breaks
open and the earth that holds the seed as it is broken. The farther
she has gone, the closer she comes. The more she lost, the more
she found. Her body is formed by what she touches. Blind, she
sees. Deaf, she hears. The wind is her breathing. In her emptiness,
she fills. In her erasures, she is writing. The colder the air, the
deeper she flows. The more that it rains, the more rain she carries.
The more stones in her path, the more she laughs.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>12 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Here, a sketch of shore. The pencil draws a water line, a vanishing
point. In graphite, wings of a bird in flight. Two more curves,
parabolas that float. Next, between the boat’s ribs, a bench. A
wave on the water’s surface — not much — just a few grasses on
shore bent beneath a wind. Then a shadow, three-dimensional.
There&#39;s a need to leave things out, those that peer uneasily,
advance, and then withdraw. Granite outcroppings — broken by
ice. Already the currents pull and the hull lifts and sways, restless.
I render this as if I were — disembarked — without a body, a
current of air.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>13 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
I walk along this edge over the narrow holes of diamond drillers.
Above the horizon, seagulls draw arcs in flight. In the morning on
shore, sandpipers run on the wet sand. Feathers lift and fall, driven
by wind&#39;s breath. I find, half buried in the sand, lost thresholds.
Scrolls of birch bark, small arches, angles and grayed frames doors
that once opened and closed.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>14 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Jointed and broken, the skeletal hand raked the beach. It drifted
and reached, five long finger bones bleached and worn clean. Wind
blew from the northeast. No other bones to be seen — no other
walkers. Grass chased and bent along the dunes. Trees leaned away
from the sea. Clouds lifted in each crest and small worn stones
rode through the knuckles, unsettled the bottom and left no print.
The water was sky across the surface, clear and tinted with old
blood or rust, rot of fish and soft ice. Inside were rivers and
constellations, storm wrecks and lives ground into splinters.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>15 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
In the hollow of the body, a crow comes with a sharp beak. The
door of the chamber opens and closes. I cannot translate this well.
The arteries are open. There is nothing apparent, the same pressure
as always. Life goes on. The shadow is long. The crow grows large
and takes short flights along low branches. I walk under the trees
when the days are short. The crow flaps its rough wings and
squawks. This what you call death, she says, I eat.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>16 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Here, bulbs are forced to bloom or planted in the ground before
winter. Here, mouths are filled with soil. There are those who
entered the tomb and grew roots and walked in cold layers to draw
the minerals out, who could yield to the shovel and receive bones,
weave a net and lift the stones, who seep or are swept into the
underground river, who decay and are kept and yet, rise in a tender
green stem to carry new buds.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>17 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
In the city are those who cannot be traced. In the city of good air
and bad are ghost cities, old cities, cities of war with lamps that no
longer burn but pierce the tongue, cities that write with smoke in
the book open to depredations and cities that reassemble endings in
a dark room of unknown dimensions, suspend belief, up-end the
fields, affix the disappeared to sheets of onion skin with stains or
smudges. They trans-literate, splice the image.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>18 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
My hand disappears over the horizon and pulls up the sea for
cover. I travel as a cloud for miles citizen of bruised sky. I cross
the waves and tides to climb the coast on the roads to the interior
and rivers flow over my banks. My border spans the continents,
and my spine, a mountain range. My arms can&#39;t carry the refugees.
Everywhere they come forth, everywhere off course.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>19 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Seagulls wheel. The hidden drifts. Freighters and ships embark in
the harbor, trembling with heat, breathe cold vapor and speak in
the language of horns. In their wake, the undocumented travel with
currents that carry the vessel. May it not sink. May they not be
detained or taken by claw or beak or roll like driftwood on the
bottom of the sea. The sands shift beneath the feet and climb the
beach.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>20 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Strangers come to the edge and double back because fences are
one thing and rivers another, because stones rise beneath the feet
and holes can be deep, because we look at the water and don&#39;t see
any crossings, because journeys disappear and time erases the map,
because vessels are small and voices can carry, because children
are heavy and nothing is cheap, because destinations are far and
some roads lead nowhere. Because language clouds the distance
between us, because no matter how many have made it or how
many have foundered, they still come, because what falls from our
grasp lands in the past, because when the wind rises, waves make
mountains to climb.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>21 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
To swing like a branch in a storm whose edges are accelerating, to
heave with the waves in the slant of hurled rain. To hear the thump
and crack in the too-early dark, see the electric pour into a hollow.
To find a vein and excavate, see absences in the landscape.

</li>
		</ul>
	</div>
</article>


<article class="poem" >
	<header>
	<h1>22 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Difficult, to move a border, clear a forest, open the furrows in the
field. We lift the seeds and scatter. Imagine a beaver on the sand
point of Lake Superior. It slides into the surf and emerges again
with a piece of driftwood, in that heavy surf, to build a house.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>23 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
In the forest, most new seeds flung by wind or wings never sprout.
Seedlings compete for the smallest bit of sun. The forest makes
waste. It doesn’t mind slash or burn. A white pine, one hundred
feet tall, can be felled by gooseberries. Dark wings flutter. A red-
headed woodpecker knocks on the houses of the dead and takes the
worms out.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>24 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
Inside the fallen trunks are roads — circles around circles. The
center was never a destination. Insects in the canyons of bark travel
with their bundles, fall into the dark rooms of the camber, get
caught in rivers of sap turning to amber. Anchored in the rot where
so much thrives — lichen reaches up to sketch on the rocks.
</li>
		</ul>
	</div>
</article>

<article class="poem" >
	<header>
	<h1>25 <a href="#top">&uarr;</a>&nbsp;&nbsp;&nbsp;</h1>
	</header>
	<div class="textContent">
		<ul class="stanza">
		<li>
A catbird hidden in the branches whistles and squeaks and whines
and mews. A catbird says whatever it hears. Short notes turn into
phrases that are repeated. He can see over the Divide, a river of
clouds. He can hear underground, in the rivers that scour the drifts,
a moneyed sound.</li>
		</ul>
	</div>
</article>

<article class="poem" id="home">
	<header>
	<h1><a href="#top">| ^ |</a> &nbsp;&nbsp;&nbsp;. . . about </h1>
	</header>
	<div class="textContent">
		<h5>thanks</h5>
		<ul data-role="narrator" class="stanza">
		<li>bell museum, , jerome</li>
		<li>the umd planetarium</li>
		<li>jerome</li>
		<li></li>
		<li></li>
		</ul>
		<h5>about</h5>
		<ul data-role="narrator" class="stanza">
		<li>this is ...</li>
		<li></li>
		<li></li>
		</ul>
		<h5>other books</h5>
		<ul data-role="narrator" class="stanza">
		<li></li>
		</ul>
	</div>
</article>
</main>
</div>
</div>
</body>
<script src="code/velocity.min.js"></script>
<script src="code/kefir201911.min.js"></script>
<!-- <script src="code/atlasabsence.js"></script> -->
<script>
let width = window.innerWidth, height = window.innerHeight;
let min = Math.min(width, height), max = Math.max(width, height);
let version = (min < 680 || max < 980) ? "small" : "large";
let v = version === "small" ? 0 : 1;
let z = {};
z.tools = {
	randominteger: (min, max) => {
		return Math.floor( min + Math.random()*(max-min));
	},
	logmsg: function(msg) {
		try { 
			console.log("### ::: " + msg); 
		}
		catch(err) { z.tools.logerror(err) }
	},
	logerror: function(error) {
		try { console.log("rusty error ... " + error); }
		catch(err) {}
	},
	randomhighharmonic: () => {
		let multipliers = [10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ];
	},
	randomharmonic: () => {
		let multipliers = [5, 7.5, 10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ];
	},
	randomlowharmonic: () => {
		let multipliers = [5, 7.5, 10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ]/2;
	},
	randomkey: (object) => {
		let keys = Object.keys(object);
		let key = keys[z.tools.randominteger(0,keys.length)];
		// z.tools.logmsg("key = " + key);
		return key;
	},
	datestr: (date, options) => {
		if(options===undefined) options = {year: "numeric", month: "2-digit", day: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit"};
		return date.toLocaleTimeString("en-US", options);
		//new Date().toLocaleTimeString("en-US", {year: "numeric", month: "2-digit", day: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit"});
	},
	togrid: (min=1, max=1, x=1, ndivisions=1) => {
		let dx = Math.floor( (max-min) / ndivisions );
		return Math.floor( ( x-min+dx/2)/dx )*dx + min;
	},
};
//core elements
z.elements = ( () => {
	return {
		body: { el: document.querySelector("body") },
		main: { el: document.querySelector("main") },
		clock: { el: document.querySelector("#clock") },
		telegraph: { el: document.querySelector("#telegraph") },
		svg:  { el: document.querySelector("#svg") },
		frames: ["subtextframe", "svgframe", "wordframe", "contentframe"].reduce( (acc, id) => {
			z.tools.logmsg("create frame element ::: " + id);
			acc[id] = { el: document.querySelector("#"+id) };
			return acc;
		}, {}),
	}
})()
	
z.streams = {
	clock: ( () => {
	let dt = 1;
	let date0 = new Date();
	let t0 = Math.floor(date0.getTime()/1000);
	let state0 = { dt: dt, count: 0, date: date0, t: t0, t0: t0 };
	return Kefir.withInterval( dt*1000, emitter => { emitter.emit( { date: new Date() } ) })
			.scan( (state, e) => { 
				state.date = e.date;
				state.t = Math.floor(e.date.getTime()/1000);
				state.count = state.count + 1;
				return state;
			}, state0  )
	})( ),
	dimensions: ( () => {
		let dt = .4;
		const ngrids=[2,2], npasts=[0,0];
		let state0 = { dt: dt, count: 0,
			grid: { nrows: ngrids[v], ncols: ngrids[v], dx: Math.floor(width/ngrids[v]), dy: Math.floor(height/ngrids[v]), sw: 12, pastn: npasts[v] },
			width: width, height: height, 
			max: max, min: min, 
		};
		return Kefir.fromEvents(window, "resize").throttle(dt*1000)
			.scan( (state,e) => {
				state.width = window.innerWidth;
				state.height = window.innerHeight;
				state.max = Math.max(state.width, state.height);
				state.min = Math.min(state.width, state.height);
				state.grid.dx = Math.floor(state.width/state.grid.ncols);
				state.grid.dy = Math.floor(state.height/state.grid.nrows);
				state.grid.sw = Math.floor(Math.max(state.grid.dx*.03, state.grid.dy*.03, 4));
				return state
			}, state0) 
	})( ),
};

z.draw = z => {
	const timings = [ [380,600], [400,580], [480,500], [500,480], [580,400], [600,380], [640,340], [680,300], [700,280], [740,240], [780,200], [800,180], [840,140], [880,100]];
	// const timings = [ [180,800], [200,780], [280,700], [300,680], [380,600], [400,580], [480,500], [500,480], [580,400], [600,380], [640,340], [680,300], [700,280], [740,240], [780,200], [800,180], [840,140], [880,100]];
	z.streams["clock"].onValue( e => {
		z.elements["clock"].el.innerHTML = z.tools.datestr(new Date(e.t*1000));
	});
	//visibility controls
	( () => { 
		let main = document.querySelector("main");
		let controls = document.querySelector("#controls");
		let hidelink = document.querySelector("#hidelink");
		let menulink = document.querySelector("#menulink");
		//hidelink
		Kefir.fromEvents(hidelink, "click").onValue( e => {
			try {
				z.tools.logmsg("hide content");
				main.style.opacity=0;
				controls.style.display='none';
				menulink.style.display='block';
			} catch(e) { z.tools.logerror("hidelink " + e) }
		});
		//menulink
		Kefir.fromEvents(menulink, "click").onValue( e => {
			try {
				z.tools.logmsg("show content");
				main.style.opacity=0.8;
				// main.style.backgroundColor=0, 0, 0, 0.4;
				menulink.style.display='none';
				controls.style.display='block';
			} catch(e) { z.tools.logerror("menulink " + e) }
		});
	})();

	const playlist = [
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#9a0000", "#fcfbe3", "#191918"], //"warmbwred",
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#ffcc00", "#fcfbe3", "#191918"], //"warmbwyellow",
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#006699", "#fcfbe3", "#191918", "#4b4b44"], //"warmbwbluegray",
		// ["#006699", "#fcfbe3", "#191918", "#004488"], //"warmbwbluegray",
		// ["#006699", "#fcfbe3", "#191918"], //"warmbwblue",
		// ["#006699", "#006666", "#fcfbe3", "#191918"], //"warmbwbluegreen",
		["#CCD8EA", "#CBD3DA", "#818794", "#5B5756", "#413A36", "#413B30"], //lake superior
		["#BEC4D0", "#C9CDD8", "#7E808C", "#282730", "#54545F", "#A5ACBF", "#AAA9A5", "#FBFBFF", "#535763", "#211F2B"], //canada snow
		// ["#4B2D13", "#081B30", "#194874", "#0B1C2C", "#0B1C2C", "#101721", "#305F83"], //canada night image w/brown
		["#172F4F", "#2A68A1", "#2B4E6B", "#103354", "#3C6FA4"], //canada night image
		["#C7CED8", "#C2C5CC", "#9C9A9D", "#454140", "#454140", "#383330", "#473D3B", "#767B7F"], //lake superior
		["#CAC4BE", "#A49C99", "#716863", "#675F5A", "#8C857F", "#6D6560", "#635A55", "#948D87", "#655D58", "#C7C1BA"], //farm gradient
		["#5B534E", "#685E59", "#9E948E", "#C3BBB5", "#999089", "#978D87"], //farm gradient
		["#2A3135", "#596D86", "#8598B1", "#B8BFD3", "#6C7C8C", "#566D8B"], //farm gradient blue
		["#3D1C04", "#0D0604", "#411B0D", "#6D3F26", "#8E7061", "#8E9490"], //cellosacredheart
		["#A3958A", "#A49389", "#82706C", "#7C6D66", "#786662", "#746663"], //gravelroadcanada
		["#C3C6CF", "#5775B0", "#837C7D", "#7A535B", "#593B3B", "#413B3F"], //boots jeans rock
		["#4E505D", "#4F525A", "#808394", "#A4AAB8", "#DEE5F7", "#E6EFFD"], //ice snow river
		["#45424A", "#393536", "#726558", "#B3A6A0", "#6C6060", "#818175", "#8C8E76", "#565C57"], //river rock (greens)
		["#7F7655", "#7C7C58", "#4C4F3A", "#ADA590", "#969374", "#7B7458", "#7D815D", "#454425", "#948C7F", "#5F6E4C", "#474633", "#BEB7A5"], //grasses (green)
		["#6B6259", "#43403B", "#51524D", "#8A300F", "#743B1D", "#988071", "#2D2F2E", "#B9AA8D", "#64655E"], //cello stairwell*
		["#696566", "#706E6F", "#79796E", "#AFB199", "#898A7C", "#676357", "#C8CAC9", "#41382C"], //moss
		["#8F97A2", "#5A575E", "#666A79", "#474C58", "#8790A0", "#B5C2D2", "#4E5043", "#181919"], //winter blue green tree
		["#EFF0F2", "#DAD1C5", "#828075", "#353934", "#0F1214", "#091007", "#47493D", "#393E2F", "#484E42", "#2D372E"], //greens mist railway duluth
		["#BCBFC4", "#B9BABE", "#9FA0A5", "#98999E", "#72757A", "#63686E", "#555F64", "#505C60"], //subtle lake surface grays

		["#6C6B6D", "#4B4B4D", "#373435", "#494C57", "#2E2B2E", "#242225", "#5F6264"], //rocks
		["#F8FCFD", "#A2B2CC", "#7A8193", "#6D6B51", "#5A583A", "#2C2D24", "#7D92AE", "#615F62", "#5C6C6C"], //lake superior
		["#485654", "#3D4949", "#7B8F9D", "#8695A3", "#8C99A1", "#82959C", "#839298", "#768387", "#738187", "#637074", "#738891", "#566871", "#BCCCD0", "#8698AA", "#515E65", "#35404E", "#566367"], //lake superior
		["#0E0600", "#2E0F04", "#0F0700", "#484E42", "#577871", "#010101", "#FFFFFF", "#406861", "#902200"], //cello at sacred heart
		["#78685B", "#B4A19A", "#877C6A", "#2F3C35", "#435046", "#242216", "#6B867D", "#993B21", "#000100", "#725128", "#15211D"], //cello at sacred heart
		["#A8B0C3", "#9599A7", "#242222", "#292724", "#49484B", "#ADAEB3", "#2B2328", "#3F3F4F"], //canada winter
		["#C5E0FB", "#F3FBFD", "#52615E", "#18191B", "#90969A", "#27292E", "#A7C2E0", "#6B838D", "#7E9889", "#1B1E3E", "#110F24"], //waterfall
		["#393411", "#705010", "#546457", "#344647", "#497087", "#7D9AB0", "#FCD17C", "#416064"], //dudley water leaves
		["#D1E3EF", "#9DAB92", "#8F9675", "#7A7E64", "#727A53", "#535E39", "#576245", "#566163", "#686E60"], //tree
		["#839FB6", "#AEB7BF", "#A3A6A9", "#797B7B", "#3D4048", "#393A3B", "#688896", "#7C8FAA", "#3F5468"], //lake superior
		["#1A0A03", "#2D0E08", "#6B2E12", "#613716", "#9E6528", "#5F370C", "#9A1905", "#FFF9C9"], //cello at sacred heart
		["#163341", "#172F47", "#4477A8", "#2A4A69", "#52779B", "#000000", "#384B60", "#1F3350", "#153A69", "#153559", "#9D9990", "#9D9990", "#181E21", "#0C1D32", "#706959", "#D6D3CE", "#534E48", "#3E5766", "#222E34", "#BBB4A4", "#7C7D7F"], //birdland
		["#414141", "#2B2B2A", "#615146", "#634D3B", "#947049", "#525B68", "#EDE8DB", "#2B261B", "#515262"], //outdoors fall
		["#778BA8", "#5E6D86", "#686C76", "#4F463D", "#5A432F", "#44301D", "#37261A", "#3F231C", "#4D739F", "#5D1215", "#352B28", "#4A2A28"], //outdoors sumac
		["#675944", "#2E2E27", "#927F56", "#A18462", "#4B4437", "#544A39", "#2C352D", "#BEA886"], //grass shadow
		["#0D0F0E", "#767577", "#9AA6B4", "#A2AFB6", "#656863", "#3C3E3C", "#5F5B50", "#38301B", "#636E76", "#82949F", "#4C5A5C", "#302D26", "#A39E8E"], //outdoors fall
		["#757260", "#616664", "#626562", "#E0E9F5", "#BFCEDF", "#A7ADB6", "#636A6C", "#5D5543", "#49402C", "#849BB4", "#5B422D", "#393E41", "#424544"], //pond
		["#17180E", "#585743", "#A9A497", "#938A5E", "#676320", "#463922", "#A76F09", "#A76406", "#3E441F", "#47502D", "#6F7948", "#A1A294", "#272C12"], //lake summer woods
		["#7086A6", "#6E7C78", "#7895BF", "#424639", "#4A6B99", "#7389A3", "#4B607F", "#4F688A", "#263040", "#283247", "#3D536F", "#222126", "#948F84"], //lake
		["#556D7F", "#444E33", "#4B5A37", "#50663E", "#6C7937", "#59613E", "#2A2D1E", "#545B38", "#788049", "#998800", "#324528", "#161B13", "#1B2519", "#343222"], //orchard
		["#7A6C57", "#46382F", "#745F4F", "#928B88", "#977E6C", "#E2E3E7", "#3C3023", "#41491D", "#2C2521"], //muddy creek
		["#E8DFD7", "#DDD6D0", "#8C8780", "#51504A", "#A9A69F", "#D2CCC4", "#444440", "#66685F", "#393B34", "#20211A", "#67665F"], //woods winter snow
		["#EAF1F2", "#AFB4BB", "#A3998A", "#735F48", "#5B4F45", "#66513A", "#3D2A1D", "#050A0D", "#53463A"], //looom
		["#181410", "#3B302E", "#63544B", "#80756C", "#BFB3A5", "#978777", "#28221D", "#131111", "#E7D7BB", "#3D3730", "#F7EBD5"], //weaving
		["#C4BBAC", "#492E21", "#514A47", "#3C3833", "#46443E", "#73695E", "#897768", "#8A7766", "#0F0F0F", "#F5E7CD", "#393633", "#2F2F2C"], //weaving
		["#183C76", "#64665C", "#967B21", "#5084CB", "#34361D", "#503E2B", "#38370E"], //bright day blue sky yellow leaves
		["#AAAAAC", "#7C7C7C", "#747371", "#525251", "#797372", "#343632", "#0C0E0B", "#42433E", "#434544", "#6C6D68"], //winter
		["#494B4A", "#494B4A", "#534B41", "#373934", "#8C887F", "#504531", "#201F19", "#5F5E5D", "#604F3D", "#5A5A57", "#30322C", "#211D15", "#696964", "#1F231B", "#393B36", "#554A47"], //winter
		["#525762", "#4A525F", "#5D6471", "#929DAE", "#AAB5CC", "#A5B0C3", "#353943", "#545F72"], //slate winter sky
		["#FFFFFF", "##313331", "#524E4A", "#391F18", "#813B2B", "#A15444", "#354141", "#222222"], //nystairs
		["#332725", "#535051", "#705E5A", "#80807F", "#7A756B", "#80807F", "#E8EDF2", "#785E56", "#47484A"], //nystairs
		["#42433E", "#5C5C58", "#81796C", "#484238", "#5C5042", "#000000", "#1F2C40", "#2B3E57", "#2A3540", "#78766D"], //nystairs
		["#5E646F", "#9BB4C6", "#7F7976", "#4E596E", "#3E3839", "#70625A"], //nystairs
		["#786652", "#5B4031", "#1A1E1C", "#B6B7B5", "#9B999C", "#16190D", "#5F3D35", "#71391E"], //nystairs
		["#FBFBFD", "#7B7879", "#575758", "#5D5048", "#7F7066", "#3C3C3C"], //nystairs
		["#977A6D", "#5B5350", "#87847D", "#57646F", "#AFBBC2", "#B6ADA8", "#1B3B51", "#2D2E31", "#546877"], //nystairs
		["#093F68", "#005A98", "#000112", "#E8ECF5", "#A8B5C8", "#538096", "#45758A", "#234E64", "#001929", "#0A4761", "#00132A", "#095A74", "#033A56", "#0C6180"], //lake superior
		["#BFB9A8", "#C3B481", "#6D604B", "#8E7A6E", "#8097AE", "#3B2F30", "#7F97AE"], //lake sand
		["#C3D3E1", "#A5B3BF", "#E5D1B7", "#E7D093", "#8C6F54", "#8CA0B1"], //lake sand
		["#484A2B", "#423F33", "#594E43", "#91827C", "#C9C7C6", "#44502A", "#5D6445"], //finnish forest
		["#893D22", "#A9400A", "#BBB594", "#732D14", "#ACB9A2", "#5A1B00", "#87886B"], //iowa brick bldg
		["#E5E2E6", "#CAC7C9", "#786458", "#5B4D41", "#644629", "#5F5E50", "#943800", "#2F1E0C", "#47453E", "#372A1E"], //iowa brick bldg
		["#9B3C16", "#922400", "#A07E66", "#BAB8B5", "#E5E6E1", "#A16F58", "#421A03", "#381A04", "#481D09", "#939284"], //iowa brick bldg
		["#D3D3D5", "#B2B3B6", "#1F1F20", "#444C35", "#6F6C5C", "#7F745C", "#3C3F31", "#726A52", "#817153"], //iowa stone bldg
		["#6A4E45", "#8F7257", "#836D60", "#979EA2", "#54615E", "#45493C"], //iowa stone bldg
		["#787574", "#C3C3C4", "#616263", "#595139", "#3A3E27", "#ABABA9", "#363D23", "#746E64"], //iowa stone bldg
		["#F2F4F8", "#90A2B1", "#475360", "#4E3728", "#B95F2E", "#4C5B70", "#678296", "#293E45"], //lake superior
	];
	z.streams["color"] = ( dt => {
		let date0 = new Date();
		let t0 = Math.floor(date0.getTime()/1000);
		let state0 = { 
			dt: dt, count: 0,
			choices: playlist[ Math.floor(t0/dt)%playlist.length ]
		};
		return z.streams["clock"].filter( e => e.t%dt===0 )
			.scan( (state, e) => { 
				state.choices = playlist[ Math.floor(e.t/dt)%playlist.length ];
				state.count = state.count + 1;
				return state;
			}, state0  )
	})( 48 );
	
	z.streams["draw"] = Kefir.combine([z.streams["clock"]], [z.streams["dimensions"], z.streams["color"]], (clock, dimensions, color) => { return {clock:clock, dimensions:dimensions, color:color} })
		.scan( (state, e) => { 
			state.clock = e.clock;
			state.dimensions = e.dimensions;
			state.color = e.color;
			state.count = state.count + 1;
			z.tools.logmsg("color.choices = " + e.color.choices);
			return state;
	}, {clock:{t:0}, dt:1}  );

	//box
	( dt => {
		const element = document.createElementNS("http://www.w3.org/2000/svg", "rect");
		element.setAttributeNS(null, "id", "box");
		element.setAttributeNS(null, "class", "shape square");
		z.elements["svg"].el.appendChild(element);
			
		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			try {
				let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
				Velocity({	
					elements: element, 
					properties: { fillOpacity: 1.0, strokeOpacity: 0.0, fill: color, width: e.dimensions.width, height: e.dimensions.height },
					options: { duration: 2000,  delay: 0, easing: "easeInOutQuad" },
				});
			} catch(err) { z.tools.logerror("box animation ::: " + err ) }
		})
	})(5);

	//poems
	( dt => {
		const afterclassnames1 = ["after0", "after1", "after2", "after3", "after4", "after5", "after6", "after7", "after8", "after9", "after10", "after11", "after12", "after13"];
		const afterclassnames2 = ["afterblackwhite", "afterwhiteblack"];
		const warmblacktints = ["#191918", "#2f2f2f", "#464646", "#5e5e5d", "#757574", "#8c8c8b", "#a3a3a2", "#babab9", "#d1d1d0", "#e8e8e7", "#ffffff", "#fcfbe3", "#e2e1cc", "#c9c8b5", "#b0af9e", "#979688", "#7e7d71", "#64645a", "#4b4b44", "#32322d", "#191916", "#000000"];
		const elements = ( () => {
			return Array.from(document.querySelectorAll(".poem")).reduce( (acc,el,j)=> {
				z.tools.logmsg("create poem element ::: " + j);
				// el.setAttribute("id", "poem"+j);
				acc[j]={ el:el, id:"poem"+j, stanzas: Array.from(el.querySelectorAll(".stanza")).reduce( (acc,el,j)=> {
					// z.tools.logmsg("el.className ::: " + el.className);
					el.setAttribute("id", "stanza"+j);
					el.className= "stanza " + afterclassnames1[j%afterclassnames1.length] + " " + afterclassnames2[0];

					acc[j]={ el:el, lines:Array.from(el.querySelectorAll("li")).reduce( (acc,el,j)=> {
						// z.tools.logmsg("create line element ::: " + j);
						// el.setAttribute("id", "line"+j);
						acc[j]={ el:el };
						return acc;
						}, []) }; 
					return acc;
				}, []) };
				return acc;
			}, []);
		})();
		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			try {
				let count = e.clock.t/dt;
				// let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
				let color = warmblacktints[z.tools.randominteger(0, warmblacktints.length)];
				elements.forEach((poem,p) => {
					poem["stanzas"].forEach((stanza,s) => {
						if(count%2===0) {
							stanza.el.className= "stanza " + afterclassnames2[count/2%afterclassnames2.length] + " " + afterclassnames1[z.tools.randominteger(0,afterclassnames1.length)];
						}
						else {
							stanza["lines"].forEach( (line,l) => {
								// line.el.style["color"] = warmblacktints[z.tools.randominteger(0,warmblacktints.length)];
								line.el.style["color"] = e.clock.t%15<4 ? "#ffffff" : warmblacktints[z.tools.randominteger(0,warmblacktints.length)];
								// line.el.style["color"] = e.clock.t%48<4 ? "#fcfbe3" : e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							})
						}
					})
				});
			} catch(err) { z.tools.logerror("poem animation ::: " + err ) }
		})
	})(7);


	//main
	( dt => {
		const element = document.querySelector("main");
		const bgcolors = ["rgba(25, 25, 24, 0.4)", "rgba(25, 25, 24, 0.6)", "rgba(25, 25, 24, 0.9)", "rgba(252, 251, 227, 0.4)", "rgba(252, 251, 227, 0.9)", , "rgba(252, 251, 227, 0.6)"]
			
		// const warmblacktints = ["#191918", "#2f2f2f", "#464646", "#5e5e5d", "#757574", "#8c8c8b", "#a3a3a2", "#babab9", "#d1d1d0", "#e8e8e7", "#ffffff", "#fcfbe3", "#e2e1cc", "#c9c8b5", "#b0af9e", "#979688", "#7e7d71", "#64645a", "#4b4b44", "#32322d", "#191916", "#000000"];
		const warmblacktints = ["#191918", "#fcfbe3", "#000000"];

		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			try {
				let count = e.clock.t/dt;
				let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
				Velocity({	
					elements: element, 
					properties: { backgroundColor:  e.clock.t%48<4 ? "#191918" : color, backgroundColorAlpha: e.clock.t%48<4 ? 0.6 : z.tools.randominteger(0.1,5)/10},
					options: { duration: 1200,  delay: 0, easing: "easeInOutQuad" },
				});
				if(count%48===0) { 
					if(main.getAttribute("data-state") === "expanded") { 
						main.classList.remove("expand"); main.classList.add("compress");
						main.setAttribute("data-state", "compressed"); 
					} 
					else { 
						main.classList.remove("compress"); main.classList.add("expand");
						main.setAttribute("data-state", "expanded");
					};
				}

			} catch(err) { z.tools.logerror("main animation ::: " + err ) }
		})
	})(9);


	//words
	( dt => {
		const nwords = [[0,1],[0,1,2,3]][v];
		const words = ["_.._._+ . < +=_.._._+ . < +=_.._._+ . < +=: :  . < > '",
		". . . . . .& | { . . ::: x",
		// "it was like this every morning", ".. - / .-- .- ... / .-.. .. -.- . / - .... .. ... / . ...- . .-. -.-- / -- --- .-. -. .. -. --.", //it was like this every morning
		// "aXQgd2FzIGxpa2UgdGhpcyBldmVyeSBtb3JuaW5n", //it was like this every morning
		"01101000 01100101 01101100 01101100 01101111 00100000 01110111 01101111 01110010 01101100 01100100", //hello world
		// "aGVsbG8gd29ybGQ=", //hello world
		"i0i000i0000iiii0i000i0000iii", //i
		"_.._._+ . < +=_.._._+ . < +=_.._._+ . < +=: :  . < > '",". . . . . .& | { . . ::: x",
		// "#thecount ‰ 0 1 2 3 4 5 6 7 8 9 iº #aftercount #aftertime", //
		// "høly h0L¥ hølY H0ly ® Å",
		"Ö x x x ø 0 Ø x X x ø 0 Ø xº3",
		// "forEach Å øn t0uch Ž",
		".. - / .-- .- ... / .-.. .. -.- . / - .... .. ... / . ...- . .-. -.-- / -- --- .-. -. .. -. --."];
		const elements = nwords.reduce( (acc, id, j) => {
			z.tools.logmsg("create word element ::: " + id);
			let el = document.createElement("div");
			el.setAttribute("id", "word_" + id);
			el.setAttribute("class", "absolute monospace_zerodot");
			// el.setAttribute("style", "font-size:"+Math.max(20,100/nwords.length)+"vh, opacity:0");
			el.innerHTML = words[j%words.length];
			z.elements["frames"]["wordframe"].el.appendChild(el);
			el.style[ "fontSize" ] = Math.max(20,100/nwords.length)+"vh";
			el.style[ "opacity" ] = 0.0;
			el.style[ "whiteSpace" ] = "nowrap";
			acc[id] = { el: el };
			return acc;
		}, []);
		const drawings = [
			e => {
				try {
					let dy = Math.floor(e.dimensions.height/elements.length);
					let count = e.clock.t/dt;
					let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
					elements.forEach( (element, j) => {
						element.el.innerText = words[(count+j)%words.length];
						let textwidth = element.el.clientWidth;
						let direction=(j+count)%2===0 ? -1.0 : 1.0;
						let startleft = (j+count)%2===0 ? e.dimensions.width : -2.0*textwidth;
						let endleft = (j+count)%2===1 ? e.dimensions.width : -2.0*textwidth;
						element.el.style[ "left" ] = startleft;
						element.el.style[ "top" ] = (j*dy-dy/3) + "px";
						Velocity({	
							elements: element.el,
							properties: { opacity:0.4 },
							options: { duration: dt*100,  delay: 0 },
						});
						Velocity({	
							elements: element.el,
							properties: { opacity:1.0, left: endleft, color: color },
							options: { duration: z.tools.randominteger(dt*200,dt*400),  delay: z.tools.randominteger(0, dt*220), easing: "linear" },
						});
						Velocity({	
							elements: element.el,
							properties: { opacity:0.0 },
							options: { duration: dt*280,  delay: 0 },
						});
					})
				} catch(err) { z.tools.logerror("word 1 animation ::: " + err ) }
			},
		]
		z.tools.logmsg("#circ elements = " + elements.length);
		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			drawings[Math.floor(e.clock.t/(dt*elements.length))%drawings.length](e);
		})
	})(18);

	//lines
	( dt => {
		const nlines=[[0,1,2,3],[0,1,2,3,4,5,6,7]][v];
		const elements = nlines.reduce( (acc, id) => {
			z.tools.logmsg("create line element ::: " + id);
			let el = document.createElementNS("http://www.w3.org/2000/svg", "line");
			el.setAttributeNS(null, "id", "line_"+ id);
			el.setAttributeNS(null, "class", "shape line");
			z.elements["svg"].el.appendChild(el);
			acc[id] = { el: el };
		return acc;
		}, []);
		const drawings = [
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let timing = timings[z.tools.randominteger(0,timings.length)];
					elements.filter((element,j) => j%2===0).forEach( (element, j) => {
						let cy = e.dimensions.height/2;
						let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						Velocity({	
							elements: elements[2*j].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(12, e.dimensions.max), strokeDasharray: z.tools.randominteger(8, e.dimensions.min), x1: 0, x2: e.dimensions.width, y1: cy, y2: cy },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 200 },
						});
						color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];

						Velocity({	
							elements: elements[2*j+1].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(10, e.dimensions.min), strokeDasharray: z.tools.randominteger(4, e.dimensions.min/4), x1: 0, x2: e.dimensions.width, y1: cy, y2: cy },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 300 },
						});
					})
				} catch(err) { z.tools.logerror("line animation 1 ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let timing = timings[z.tools.randominteger(0,timings.length)];
					elements.filter((element,j) => j%2===0).forEach( (element, j) => {
						let cx = (j%e.dimensions.grid.ncols)*dx + dx/2;
						let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						Velocity({	
							elements: elements[2*j].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(12, e.dimensions.max), strokeDasharray: z.tools.randominteger(8, e.dimensions.min), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 0 },
						});
						color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						timing = timings[z.tools.randominteger(0,timings.length)];
						Velocity({	
							elements: elements[2*j+1].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(10, e.dimensions.min), strokeDasharray: z.tools.randominteger(4, e.dimensions.min/4), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 500 },
						});
					})
				} catch(err) { z.tools.logerror("line animation 2 ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let timing = timings[z.tools.randominteger(0,timings.length)];
					elements.filter((element,j) => j%2===0).forEach( (element, j) => {
						// let cx = (j%e.dimensions.grid.ncols)*dx + dx/2;
						let cx = e.dimensions.width/2;
						let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						Velocity({	
							elements: elements[2*j].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(e.dimensions.max/2, e.dimensions.max), strokeDasharray: z.tools.randominteger(8, e.dimensions.min), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 0 },
						});
						color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						timing = timings[z.tools.randominteger(0,timings.length)];
						Velocity({	
							elements: elements[2*j+1].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(e.dimensions.min/2, e.dimensions.min), strokeDasharray: z.tools.randominteger(4, e.dimensions.min/4), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 500 },
						});
					})
				} catch(err) { z.tools.logerror("line animation 2 ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let timing = timings[z.tools.randominteger(0,timings.length)];
					elements.filter((element,j) => j%2===0).forEach( (element, j) => {
						// let cx = (j%e.dimensions.grid.ncols)*dx + dx/2;
						let cx = e.dimensions.width/2;
						let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						Velocity({	
							elements: elements[2*j].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(e.dimensions.max/2, e.dimensions.max), strokeDasharray: z.tools.randominteger(8, e.dimensions.min), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 0 },
						});
						color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						timing = timings[z.tools.randominteger(0,timings.length)];
						Velocity({	
							elements: elements[2*j+1].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(e.dimensions.min/2, e.dimensions.min), strokeDasharray: z.tools.randominteger(4, e.dimensions.min/4), y1: 0, y2: e.dimensions.height, x1: cx, x2: cx },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 500 },
						});
					})
				} catch(err) { z.tools.logerror("line animation 2 ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let timing = timings[z.tools.randominteger(0,timings.length)];
					elements.filter((element,j) => j%2===0).forEach( (element, j) => {
						let cy = j%2===0 ? 0 : e.dimensions.height/2;
						let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						Velocity({	
							elements: elements[2*j].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(12, e.dimensions.max), strokeDasharray: z.tools.randominteger(8, e.dimensions.min), y1: cy, y2: cy, x1: 0, x2: e.dimensions.width },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 0 },
						});
						color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
						timing = timings[z.tools.randominteger(0,timings.length)];
						Velocity({	
							elements: elements[2*j+1].el,
							properties: { strokeOpacity: 1.0, stroke: color, strokeWidth: z.tools.randominteger(10, e.dimensions.min*2), strokeDasharray: z.tools.randominteger(4, e.dimensions.min/2), y1: cy, y2: cy, x1: 0, x2: e.dimensions.width },
							options: { duration: z.tools.randominteger(e.dt*timing[0], e.dt*timing[0]*3),  delay: 300 },
						});
					})
				} catch(err) { z.tools.logerror("line animation 3 ::: " + err ) }
			}
		];
		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			drawings[Math.floor(e.clock.t/(dt*elements.length))%drawings.length](e);
		})
	})(3);

	//circles
	( dt => {
		const ncircles=[[0,1,2,3,4,5,6,7],[0,1,2,3,4,5,6,7,8,9,10,12,13,14,15]][v];
		const elements = ncircles.reduce( (acc, id) => {
			z.tools.logmsg("create circle element ::: " + id);
			let el = document.createElementNS("http://www.w3.org/2000/svg", "circle");
			el.setAttributeNS(null, "id", "circle_"+ id);
			el.setAttributeNS(null, "class", "shape circle");
			z.elements["svg"].el.appendChild(el);
			acc[id] = { el: el };
			return acc;
		}, []);
		// const elements = z.elements["circles"];
		const drawings = [
			e => {
				try {
					let count = e.clock.t/dt;
					let l = elements.length;
					let minradius = e.dimensions.min/l*z.tools.randominteger(3,14)/10;
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<8) {
							let cy = Math.floor(e.dimensions.height/2);
							let cx = Math.floor(e.dimensions.width/2);
							let radius = (l-j)*minradius;
							// z.tools.logmsg("circle 1 cx= "+cx+" cy= " + cy + " radius = " + radius);
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%3===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%2===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(4,radius/2), strokeDasharray: z.tools.randominteger(4, radius*2), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*4), delay: j*60 },
							});
						}
						
					})
				} catch(err) { z.tools.logerror("circles 1 animation ::: " + err ) }
			},
			e => {
				try {
					let count = e.clock.t/dt;
					let l = elements.length;
					let minradius = e.dimensions.min/l*z.tools.randominteger(3,20)/10;
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<8) {
							let cy = Math.floor(e.dimensions.height/2);
							let cx = Math.floor(e.dimensions.width/2);
							let radius = (l-j)*minradius;
							// z.tools.logmsg("circle 2 cx= "+cx+" cy= " + cy + " radius = " + radius);
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%5===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%5===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(4,radius/8), strokeDasharray: z.tools.randominteger(4, radius*2), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*4), delay: j*60 },
							});
						}
						
					})
				} catch(err) { z.tools.logerror("circles 1 animation ::: " + err ) }
			},
			e => {
				try {
					let count = e.clock.t/dt;
					let l = elements.length;
					let minradius = e.dimensions.min/l*z.tools.randominteger(4,20)/10;
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<8) {
							let cy = Math.floor(e.dimensions.height/2);
							let cx = Math.floor(e.dimensions.width/2);
							let radius = (l-j)*minradius;
							// z.tools.logmsg("circle 3 cx= "+cx+" cy= " + cy + " radius = " + radius);
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%2===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%2===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(4,radius/8), strokeDasharray: z.tools.randominteger(4, radius*2), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*4), delay: j*60 },
							});
						}
						
					})
				} catch(err) { z.tools.logerror("circles 1 animation ::: " + err ) }
			},
			// e => {
			// 	try {
			// 		let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
			// 		let min = Math.min(dx,dy);
			// 		let count = e.clock.t/dt;
			// 		let cys = [e.dimensions.height/3, 2*e.dimensions.height/3, e.dimensions.height/3, 2*e.dimensions.height/3];
			// 		let cxs = [e.dimensions.width/3, e.dimensions.width/3, 2*e.dimensions.width/3, 2*e.dimensions.width/3];
			// 		elements.forEach( (element, j) => {
			// 			if(z.tools.randominteger(0,10)<6) {
			// 				// let cy = Math.floor(j/(2*e.dimensions.grid.ncols))*dy  + dy/2;
			// 				// let cx = (j%e.dimensions.grid.ncols)*dx + dx/2;
			// 				let cx = cxs[j%cxs.length], cy = cys[j%cys.length]
			// 				let radius = min*z.tools.randominteger(1,6)/10;
			// 				z.tools.logmsg("circle 2 cx= "+cx+" cy= " + cy + " radius = " + radius); 
			// 				let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
			// 				Velocity({	
			// 					elements: element.el,
			// 					properties: { fillOpacity: (j+count)%3===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%2===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(10,radius*2), strokeDasharray: z.tools.randominteger(4, radius*4), fill: color, cx: cx, cy: cy, r: radius },
			// 					options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*4), delay: j*60 },
			// 				});
			// 			}

			// 		})
			// 	} catch(err) { z.tools.logerror("circles 2 animation ::: " + err ) }
			// },
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let min = Math.min(dx,dy);
					let count = e.clock.t/dt;
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<8) {
							let cy = e.dimensions.height/2;
							let cx = j%3===0 ? 0 : (j%2===0 ? e.dimensions.width/2 : e.dimensions.width);
							let radius = min*z.tools.randominteger(1,20)/10;
							// z.tools.logmsg("circle 3 cx= "+cx+" cy= " + cy + " radius = " + radius); 
							// if(Math.floor(count)%3!==0 && j%e.dimensions.grid.ncols===0) { color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];}
							// if(Math.floor(count)%4!==0 && j%e.dimensions.grid.nrows===0) { color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];}
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%3===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%2===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(10,radius*2), strokeDasharray: z.tools.randominteger(4, radius*4), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*4), delay: j*60 },
							});
						}
					})
				} catch(err) { z.tools.logerror("circles 3 animation ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let min = Math.min(dx,dy);
					let count = e.clock.t/dt;
					
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<8) {
							let cy = e.dimensions.height/2;
							let cx = j%2===0 ? e.dimensions.width/2 -dx : e.dimensions.width/2 + dx;
							let radius = min*z.tools.randominteger(1,20)/10;
							// z.tools.logmsg("circle 4 cx= "+cx+" cy= " + cy + " radius = " + radius); 
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%5===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%2===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(10,radius*2), strokeDasharray: z.tools.randominteger(4, radius*4), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*3), delay: j*60 },
							});
						}

					})
				} catch(err) { z.tools.logerror("circles 4 animation ::: " + err ) }
			},
			e => {
				try {
					let dx = e.dimensions.grid.dx, dy = e.dimensions.grid.dy;
					let min = Math.min(dx,dy);
					let count = e.clock.t/dt;
					
					elements.forEach( (element, j) => {
						if(z.tools.randominteger(0,10)<6) {
							let cy = e.dimensions.height/2;
							let cx = j%2===0 ? e.dimensions.width/2 -dx : e.dimensions.width/2 + dx;
							let radius = min*z.tools.randominteger(1,30)/10;
							// z.tools.logmsg("circle 4 cx= "+cx+" cy= " + cy + " radius = " + radius); 
							let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
							Velocity({	
								elements: element.el,
								properties: { fillOpacity: (j+count)%5===0 ? 1.0 : 0.0, strokeOpacity: (j+count)%5===0 ? 0.0 : 1.0, stroke: color, strokeWidth: z.tools.randominteger(10,radius*2), strokeDasharray: z.tools.randominteger(4, radius*4), fill: color, cx: cx, cy: cy, r: radius },
								options: { duration: z.tools.randominteger(e.dt*400, e.dt*400*3), delay: j*60 },
							});
						}

					})
				} catch(err) { z.tools.logerror("circles 4 animation ::: " + err ) }
			}
		]
		z.tools.logmsg("#circ elements = " + elements.length);
		z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
			drawings[Math.floor(e.clock.t/(dt*elements.length))%drawings.length](e);
		})
	})(2);

};
z.radio = ( () => { 
	const soundcorepath = "data/sound/";
	const instruments = {
		bagpipe1a: {clip: "bagpipe1a", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },
		bagpipe1ahigh: {clip: "bagpipe1a", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1e: {clip: "bagpipe1e", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1f: {clip: "bagpipe1f", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1g: {clip: "bagpipe1g", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1h: {clip: "bagpipe1h", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },
		bagpipe1: {clip: "bagpipe1", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/4 } },
		bagpipe1high: {clip: "bagpipe1", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/4 } },
		thunk: {clip: "thunk", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		thunkhighharmonic: {clip: "thunk", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },
		birds5harmonic: {clip: "birds5",minvolume: 0.2, maxvolume: 0.5, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },
		knocking1: {clip: "knocking1", minvolume: 0.4, maxvolume: 0.9, playbackRate: () => { return z.tools.randominteger(4,48)/10 } },
		cmpb20200708_5harmonic: {clip: "cmpb20200708_5", minvolume: 0.4, maxvolume: 0.9, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },//* voice
		// cello_pitch1: {clip: "cello_pitch1", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// cello_pitch1harmonic: {clip: "cello_pitch1", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bird1harmonic: {clip: "bird1", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		birdcanyon: {clip: "birdcanyon", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipegeese: {clip: "bagpipegeese", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		celloknockcanyon: {clip: "celloknockcanyon", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		voxmct0: {clip: "voxmct0", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		stapler: {clip: "stapler", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		train1: {clip: "train1", minvolume: 0.4, maxvolume: 0.8, playbackRate: () => { return z.tools.randominteger(6,18)/10 } },
		weatherradio1: {clip: "weatherradio1", minvolume: 0.6, maxvolume: 1.0,  playbackRate: () => { return z.tools.randominteger(6,12)/10 } },
		longbell: {clip: "longbell", minvolume: 0.4, maxvolume: 0.8, playbackRate: () => { return z.tools.randominteger(9,18)/10 } },
		// cellothunktelephone: {clip: "cellothunktelephone", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// cellothunkradio: {clip: "cellothunkradio", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		t0: {clip: "t0", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		tornadosirenharmonic: {clip: "tornadosiren", minvolume: 0.1, maxvolume: 0.6, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },									
	};
	let clips = {};
	Object.entries(instruments).forEach( instrument => {
		clips[instrument[1].clip] = { url: soundcorepath + instrument[1].clip + ".mp3", loaded:false, duration:0, buffer:{} };
	});
	let radio = {
		player: {}, loading: [], loaded: false,
		soundplaying:false,
		instruments: instruments, clips: clips,
		clipduration: { min:0, max:0 },
		nbuffersplaying: 0, maxbuffersplaying: [14,18][v],
		intervals: {
			lowi: function(basetone){ return Math.floor(basetone/4) },
			i: function(basetone){ return Math.floor(basetone/2) },
			I: function(basetone){ return Math.floor(basetone/1) },
			II: function(basetone){ return Math.floor(basetone*9/8) },
			III: function(basetone){ return Math.floor(basetone*5/4) },
			iii: function(basetone){ return Math.floor(basetone*6/5) },
			IV: function(basetone){ return Math.floor(basetone*4/3) },
			V: function(basetone){ return Math.floor(basetone*3/2) },
			VI: function(basetone){ return Math.floor(basetone*5/3) },
			VII: function(basetone){ return Math.floor(basetone*15/8) },
			vii: function(basetone){ return Math.floor(basetone*9/5) },
			VIII: function(basetone){ return Math.floor(basetone*2) },
		},
		loadclips: z => {
			Object.keys(z.radio.clips).forEach( key => {
				let clip = z.radio.clips[key];
				if(!z.radio.loading.includes(clip.url)) {
					z.radio.loading.push(clip.url);
					let request = new XMLHttpRequest();
					//for localhost testing
					// request.open("GET", window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/web/" + clip.url, true);
					// z.tools.logmsg("url = " + window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/web/" + clip.url);
					// for deploy
					request.open("GET", window.location.protocol + "//" + window.location.hostname + "/" + clip.url, true);
					// z.tools.logmsg("url = " + window.location.protocol + "//" + window.location.hostname + "/"  + clip.url);
					request.responseType = "arraybuffer";
					request.onload = () =>  {
						z.tools.logmsg("loaded" + clip.url);
						z.radio.player.context.decodeAudioData(request.response, buffer => {
							clip.loaded = true;
							clip.buffer = buffer;
							clip.duration = clip.buffer.duration;
							if( clip.duration > z.radio.clipduration.max) {z.radio.clipduration.max = clip.duration}
							else if( clip.duration < z.radio.clipduration.min) {z.radio.clipduration.min  = clip.duration}
							z.tools.logmsg("decoded" + clip.url);
						}, e => {
							z.tools.logerror("audio error! clip = " + clip.url + ", err = " + e);
						});
						
					};
					request.send();
				}
			});
			z.radio.loaded = true;
		},
		start: z => {
			/* set up player*/
			window.AudioContext = window.AudioContext || window.webkitAudioContext;
			z.radio.player.context = new AudioContext();
			/* experimental parameters */
			let parameters = [
				{ gain: 0.4, threshold: -24, knee: 30, ratio: 12, attack: 0.003, release: 0.25 }, //default
				{ gain: 0.3, threshold: -18, knee: 30, ratio: 18, attack: 0.0003, release: 0.28 },
				{ gain: 0.5, threshold: -8, knee: 30, ratio: 18, attack: 0.003, release: 0.28 },
				{ gain: 0.8, threshold: -8, knee: 30, ratio: 18, attack: 0.003, release: 0.28 },
				];
			let n = 0;

			//with compressor
			z.radio.player.compressor = z.radio.player.context.createDynamicsCompressor();
			z.radio.player.compressor.threshold.value = parameters[n].threshold;
			z.radio.player.compressor.knee.value = parameters[n].knee;
			z.radio.player.compressor.ratio.value = parameters[n].ratio;
			
			z.radio.player.compressor.attack.value = parameters[n].attack;
			z.radio.player.compressor.release.value = parameters[n].release;
			z.radio.player.gain = z.radio.player.context.createGain();
			z.radio.player.gain.value = parameters[n].gain;
			z.radio.player.compressor.connect(z.radio.player.gain);
			z.radio.player.gain.connect(z.radio.player.context.destination);
			// //with no compressor
			// z.radio.player.gain = z.radio.player.context.createGain();
			// z.radio.player.gain.value = parameters[n].gain;
			// z.radio.player.gain.connect(z.radio.player.context.destination);
		},
		playtone: ({ volume=0.8, delay=0, fadetime=0.1, duration=1.0, frequency=380 } = {}) => { 
			let vco = z.radio.player.context.createOscillator();
			vco.frequency.value = frequency;
			vco.type = "sine";
			let vca = z.radio.player.context.createGain();
			
			vco.connect(vca);
			vca.connect(z.radio.player.gain);
			let now = z.radio.player.context.currentTime;
			//fade in
			vca.gain.exponentialRampToValueAtTime(0.001, now + delay);
			vca.gain.exponentialRampToValueAtTime(volume, now + fadetime + delay);
			//fade out
			vca.gain.exponentialRampToValueAtTime(volume, now + duration + delay - fadetime);
			vca.gain.exponentialRampToValueAtTime(0.001, now + duration + delay);
			vco.start(now + delay);
			vco.stop(now + delay + duration + fadetime);
			vco.onended = function() {
			  	vco.disconnect(); vca.disconnect();
			}
		},
		playbuffer: ( { volume=0.8, delay=0, fadetime=1, duration=2, instrument=z.radio.instruments["bagpipe1f"] } = {} ) =>  {
			try {
				// let instrument = z.radio.instruments[zinstrument];
				let clip = z.radio.clips[instrument.clip];
				z.tools.logmsg("***buffer requested = " + instrument.clip + " z.radio.nbuffersplaying = " + z.radio.nbuffersplaying);
				if(clip.loaded && (z.radio.nbuffersplaying<z.radio.maxbuffersplaying-1 || z.radio.nbuffersplaying>z.radio.maxbuffersplaying+2)) {
					let rate = instrument.playbackRate ? instrument.playbackRate() : 1.0;
					try {
						// z.tools.logmsg("rate = " + rate + " ::: duration = " + clip.duration*rate);
						let vca = z.radio.player.context.createGain(); 
						let source = z.radio.player.context.createBufferSource();
						source.buffer = clip.buffer;
						source["playbackRate"].value = rate;
						source.connect(vca);
						vca.connect(z.radio.player.gain);
						source.loop = false;
						source.onended = e =>  { 
							z.radio.nbuffersplaying=z.radio.nbuffersplaying-1;
						};
						++z.radio.nbuffersplaying;
						let now = z.radio.player.context.currentTime;
						let dur = clip.duration < duration ? clip.duration/rate : rate*duration/rate;
						let dt = Math.min(fadetime, dur*.25);
						let offset = z.tools.randominteger(0, (dur-4*dt)*10)/10;
						// source.start(now, offset, dt*4); //parameters (when,offset,duration)
						vca.gain.setValueAtTime(0.001, now);
						vca.gain.exponentialRampToValueAtTime(volume, now + dt);
						vca.gain.setValueAtTime(volume, dur - 2*dt);
						vca.gain.exponentialRampToValueAtTime(0.001, now + dur-dt*0.5 );
						source.start(now, offset, dur); //parameters (when,offset,duration)
						// z.tools.logmsg("playing = " + clip.url);
					} catch(e) { z.tools.logerror("error applying params to audio buffer e::: " + e) }
				}
				else {	
					z.tools.logmsg("NOT playing = " + clip.url);
				}
			}
			catch(err) { z.tools.logerror("line playbuffer" + err) }
		},
		play: z => {
			const defaultduration = (dt,n,graintdt,clip) => dt/(graindt*2);
			const defaultfadetime = (dt,n,graintdt,clip) => dt/(graindt*20);
			const defaultpart = (dt=4000, n=4, graindt=400, chance=0.8, duration=defaultduration, fadetime=defaultfadetime, instruments=["celloknockcanyon"]) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: duration(dt,n,graintdt), fadetime: fadetime(dt,n,graintdt), instruments: ["celloknockcanyon"] } };
			const score = [
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["birdcanyon", "birds5harmonic", "voxmct0", "cmpb20200708_5harmonic", "longbell"] } })(14000,5,500),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["train1", "tornadosirenharmonic",] } })(4000,6,500),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["celloknockcanyon", "stapler", "t0", "cmpb20200708_5harmonic", "thunkhighharmonic"] } })(5000,3,500,0.6),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["bagpipe1", "bagpipe1a", "tornadosirenharmonic", "tornadosirenharmonic"] } })(17000,6,400,0.8),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["celloknockcanyon"] } })(5000,4,400,0.8),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["bagpipe1e","bagpipe1f","bagpipe1g","bagpipe1h"] } })(3000,4,400,0.8),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["cmpb20200708_5harmonic"] } })(9000,6,400,0.8),
			];
			score.forEach( (part,j) => {
				z.streams["clock"].filter( e => e.t%Math.floor(part.dt/1000)===0 && z.tools.randominteger(0,10)<part.chance*10 && z.radio.soundplaying)
					.onValue( e=> {
						let clip = part.instruments[z.tools.randominteger(0,part.instruments.length)];
						Kefir.sequentially(part.graindt, [...Array(part.n).keys()]).onValue( x => { 
							z.radio.playbuffer({duration:part.duration, fadetime:part.fadetime, instrument:z.radio.instruments[clip], volume: z.tools.randominteger(z.radio.instruments[clip].minvolume*10, z.radio.instruments[clip].maxvolume*10)/10});
						});
					})
			});
		}
	};
	
	let soundlink = document.querySelector("#soundlink");
	let telegraph = document.querySelector("#telegraph");

	Kefir.fromEvents(soundlink, "click").onValue( e => {
		z.tools.logmsg("play sound !");
		if(!radio.soundplaying) { 
			try {
				radio.player.context.resume().then(() => {
					z.tools.logmsg("playback resumed");
					telegraph.innerHTML =  "(sound on)";
					radio.soundplaying = true;
					soundlink.classList.add("active");
				});
			} catch(e) { z.tools.logerror("dashboard ::: resumeaudio " + e) } 
		}
		else { 
			try {
				radio.player.context.suspend().then(() => {
					telegraph.innerHTML =  "(sound off)";
					radio.soundplaying = false;
					soundlink.classList.remove("active");
				});
			} catch(e) { z.tools.logerror("dashboard ::: suspendaudio " + e) }
		}
	});

	return radio;
})();
//test
z.radio.start(z);
z.radio.loadclips(z);
// z.radio.playtone();
window.addEventListener('load', e => {
  z.radio.play(z);
  z.draw(z);
  window.scroll(0,0);
  window.setTimeout(() => { document.querySelector("#contentframe").style.opacity = 1.0 }, 3800);
  window.setTimeout(() => { document.querySelector("#controls").style.backgroundColor = "rgba(0,0,0,0.0)" }, 6800);
});
window.addEventListener('beforeunload', e => {
	window.scroll(0,0);
});
</script>
</html>